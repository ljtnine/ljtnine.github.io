<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><title>结构体转网络字节 · NINE的博客</title><meta name="description" content="如以下结构的二进制00 00 00 0400 00 00 174D 65 73 73 61 67 65 53 76 63 2E 47 65 74 4D 73 67 56 32其中00 00 00 04为该段字节的头部，00 00 00 17 为长度，剩余部分为内容。C语言代码如下：
#include"><meta name="keywords" content="NINE的博客,记录与分享计算机技术"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">NINE的博客</a></h3><div class="description"><p>NINE的博客。<br> 记录与分享计算机技术。</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/xuncv"><i class="fa fa-github"></i></a></li><li><a href="mailto:xuncv1@gmail.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY="><i class="fa fa-qq"></i></a></li><li><a target="_blank" rel="noopener" href="https://zhihu.com/ljtnine/"><i class="fa fa-mortar-board"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2017 - 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div><div class="beian"><a href="http://www.beian.miit.gov.cn/" target="_blank"></a><span style="height:10px;margin-left: 10px;">|</span><img src="https://qn.jixian.io/gongan.png" style="height:10px;margin-left: 10px;position: relative;top: 1px;"><span style="margin-left: 2px;"></span></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/about">关于</a></li><li><a href="/guestbook">留言</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>结构体转网络字节</a></h3></div><div class="post-content"><p>如以下结构的二进制<br>00 00 00 04<br>00 00 00 17<br>4D 65 73 73 61 67 65 53 76 63 2E 47 65 74 4D 73 67 56 32<br>其中00 00 00 04为该段字节的头部，00 00 00 17 为长度，剩余部分为内容。<br>C语言代码如下：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wininet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFFER_SIZE 512</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> header;</span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    <span class="keyword">char</span> content[BUFFER_SIZE];</span><br><span class="line">&#125; pack;</span><br><span class="line"></span><br><span class="line">pack stu;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">if</span>((fp=fopen(<span class="string">&quot;dat.txt&quot;</span>,<span class="string">&quot;w&quot;</span>))==<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;无法打开此文件!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stu.header = htonl(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">char</span> content[] = &#123;<span class="number">0x4D</span>,<span class="number">0x65</span>,<span class="number">0x73</span>,<span class="number">0x73</span>,<span class="number">0x61</span>,<span class="number">0x67</span>,<span class="number">0x65</span>,<span class="number">0x53</span>,<span class="number">0x76</span>,<span class="number">0x63</span>,<span class="number">0x2E</span>,<span class="number">0x47</span>,<span class="number">0x65</span>,<span class="number">0x74</span>,<span class="number">0x4D</span>,<span class="number">0x73</span>,<span class="number">0x67</span>,<span class="number">0x56</span>,<span class="number">0x32</span>&#125;;</span><br><span class="line">    stu.len = htonl(<span class="keyword">sizeof</span>(content)+<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(stu.content,content);</span><br><span class="line">    <span class="keyword">if</span>(fwrite(&amp;stu, <span class="number">4</span>+<span class="number">4</span>+<span class="keyword">sizeof</span>(content), <span class="number">1</span>, fp) != <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;文件写入错误。!\n&quot;</span>);</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>aardio语言代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> wsock</span><br><span class="line"></span><br><span class="line">pack = &#123;</span><br><span class="line">	int header;</span><br><span class="line">	int len;</span><br><span class="line">	byte content[];</span><br><span class="line">&#125;</span><br><span class="line">io.open()</span><br><span class="line">pack.header = wsock.htonl(<span class="number">4</span>);</span><br><span class="line">pack.content = <span class="string">&#x27;\x4D\x65\x73\x73\x61\x67\x65\x53\x76\x63\x2E\x47\x65\x74\x4D\x73\x67\x56\x32&#x27;</span></span><br><span class="line">pack.len = wsock.htonl(#pack.content + 4)</span><br><span class="line"></span><br><span class="line">io.print( raw.sizeof(pack ) )</span><br><span class="line">re = raw.tostring( pack );</span><br><span class="line">io.print( string.escape(re) );</span><br><span class="line">string.save(<span class="string">&quot;\bin.bin&quot;</span>,re )</span><br></pre></td></tr></table></figure></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-10-07</span><i class="fa fa-tag"></i><a class="tag" href="/tags/aardio/" title="aardio">aardio </a><a class="tag" href="/tags/c/" title="c">c </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://ninecmd.com/2020/10/07/结构体转网络字节/,NINE的博客,结构体转网络字节,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2020/10/07/string-list%E7%BB%84%E5%BB%BApost%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE/" title="string.list组建post发送数据">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2020/10/07/FindMimeFromData-API%E5%88%A4%E6%96%AD%E6%96%87%E4%BB%B6MIME/" title="FindMimeFromData API判断文件MIME">下一篇</a></li></ul></div><script src="/js/visitors.js"></script><a id="comments"></a><div id="vcomments" style="margin:0 30px;"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@latest/dist/Valine.min.js"></script><script>var valine = new Valine({
  el:'#vcomments',
  notify:false || false, 
  verify:false|| false, 
  app_id:'aYHiayh3v3wRvPSaTTdlqdgF-gzGzoHsz',
  app_key:'UrM5oT6mNhBLRItb6vSY72Mn',
  placeholder:'念念不忘，必有回响...',
  path: window.location.pathname,
  serverURLs: '',
  visitor:true,
  recordIP:true,
  avatar:'mp'
})</script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/baidu-tongji.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"left","width":200,"height":400,"hOffset":5,"vOffset":-38},"mobile":{"show":false,"scale":0.2},"react":{"opacityDefault":0.8,"opacityOnHover":0.2},"log":false});</script></body></html>